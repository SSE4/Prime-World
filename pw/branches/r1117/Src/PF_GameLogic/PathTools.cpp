#include "stdafx.h"

#include "PathTools.h"
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// для вычисления сплайна
const float DELTA         = 0.02f;
const int CBSpline::N_OF_ITERATONS = 1 / DELTA;
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CBSpline::Init( const CVec2 &p3, const CVec2 &p2, const CVec2 &p1, const CVec2 &p0 )
{
	const CVec2 a = 1.0f/6.0f * ( -p3 + 3 * p2 - 3 * p1 + p0 );
	const CVec2 b = 1.0f/6.0f * ( 3 * p3 - 6 * p2 + 3 * p1 );
	const CVec2 c = 1.0f/6.0f * ( -3 * p3 + 3 * p1 );
	const CVec2 d = 1.0f/6.0f * ( p3 + 4 * p2 + p1 );

	// для построения сплайна
	d3x = a * sqr( DELTA ) * DELTA;
	dx  = d3x + b * sqr( DELTA );
	d2x = 2 * ( 2 * d3x + dx );
	dx  += c * DELTA;
	d3x *= 6;
	x = d;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// iterate spline using dt=DELTA
void CBSpline::Iterate()
{
	x   += dx;
	dx  += d2x;
	d2x += d3x;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
